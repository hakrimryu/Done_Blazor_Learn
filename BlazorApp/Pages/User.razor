@page "/user"
@using BlazorApp.Data;


<h3>Online Users</h3>

<p>
    <!-- ユーザーカウント -->
    Users : <b>@_users.Count()</b>
</p>

<br />

<ul class="list-group">
    <!-- ユーザーリストからユーザーの名前を呼ぶ -->
    @foreach (UserData user in _users)
    {
    <li @key="user" class="list-group-item">
        <!-- ユーザー削除onclickボタン -->
        <button type="button" class="btn btn-link" @onclick="(() => this.OnClickKickUser(user))">[Kick]</button>
        <label>@user.Name</label>
    </li>
    }
</ul>

<br />

<div class="container">
    <div class="row">
        <div class="col">
            <!-- ユーザー名入力フィールド -->
            <input class="form-control" placeholder="Add User" @bind-value="_inputName" />
        </div>
        <div class="col">
            <!-- ユーザー追加ボタン -->
            <!-- 属性(attribute)にもBinding -->
            <!-- conditionel attribute 自体に条件 -->>
            <button class=@this._btnClass type="button" @onclick="OnClickAddUser" disabled="@(_users.Count() >= 5)">Add a User</button>
        </div>
    </div>
</div>

@code {

    /// <summary>
    /// テストユーザーリスト
    /// </summary>
    List<UserData> _users = new List<UserData>();

    /// <summary>
    /// 入力を受けるユーザー名
    /// </summary>
    string _inputName;

    string _btnClass = "btn btn-primary";

    /// <summary>
    /// 開始時実行
    /// </summary>
    protected override void OnInitialized()
    {
        this._users.Add(new UserData { Name = "Ryu" });
        this._users.Add(new UserData { Name = "Hak" });
        this._users.Add(new UserData { Name = "Rim" });
        this.RefreshButton();
    }

    /// <summary>
    /// AddUserボタンクリック時
    /// </summary>
    void OnClickAddUser()
    {
        // ユーザーリストに、入力されたユーザー名追加
        this._users.Add(new UserData { Name = this._inputName });
        // 空き値で、初期化
        this._inputName = "";
        this.RefreshButton();
    }

    void OnClickKickUser(UserData user)
    {
        this._users.Remove(user);
        this.RefreshButton();
    }

    void RefreshButton()
    {
        if (this._users.Count() % 2 == 0)
            this._btnClass = "btn btn-primary";
        else
            this._btnClass = "btn btn-secondary";
    }
}
